{"version":3,"sources":["/Users/rquast/projects/fspec.videos/src/index.ts"],"sourcesContent":["#!/usr/bin/env node\n\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport { resolve, join } from 'path';\nimport { readdirSync, readFileSync, existsSync } from 'fs';\nimport { startRecording } from './recorder.js';\nimport { validateRecordingOptions } from './validator.js';\n\ninterface ConfigFile {\n  width?: number;\n  height?: number;\n  fps?: number;\n  headless?: boolean;\n  outputPath?: string;\n  demosDir?: string;\n}\n\nexport function loadConfigFile(cwd: string = process.cwd()): ConfigFile {\n  const configPath = join(cwd, 'fspec-videos.config.json');\n\n  if (!existsSync(configPath)) {\n    return {}; // No config file, use empty config\n  }\n\n  try {\n    const configContent = readFileSync(configPath, 'utf-8');\n    const config = JSON.parse(configContent);\n    return config;\n  } catch (error) {\n    if (error instanceof SyntaxError) {\n      throw new Error(\n        `Failed to parse fspec-videos.config.json: Invalid JSON syntax\\nConfig file location: ${configPath}`\n      );\n    }\n    throw error;\n  }\n}\n\n// Export for testing\nexport async function recordAction(\n  options: any,\n  cwd: string = process.cwd()\n): Promise<void> {\n  // Load config file\n  const config = loadConfigFile(cwd);\n\n  console.log(chalk.blue('üé¨ Starting fspec video recording...'));\n  console.log(chalk.gray(`Script: ${options.script}`));\n\n  // Merge config with CLI options (CLI takes precedence)\n  // Use CLI option if provided, otherwise use config, otherwise use default\n  const width = options.width ? parseInt(options.width) : config.width ?? 120;\n  const height = options.height\n    ? parseInt(options.height)\n    : config.height ?? 30;\n  const fps = options.fps ? parseInt(options.fps) : config.fps ?? 30;\n  const outputPath =\n    options.output ?? config.outputPath ?? 'recordings/demo.webm';\n\n  console.log(chalk.gray(`Output: ${outputPath}`));\n  console.log(chalk.gray(`Terminal size: ${width}x${height} (${fps} FPS)`));\n\n  const scriptPath = resolve(cwd, options.script);\n  const resolvedOutputPath = resolve(cwd, outputPath);\n\n  const recordingOptions = {\n    scriptPath,\n    outputPath: resolvedOutputPath,\n    width,\n    height,\n    fps,\n    headless: options.headless,\n  };\n\n  // Validate options before starting recording\n  await validateRecordingOptions(recordingOptions);\n\n  await startRecording(recordingOptions);\n\n  console.log(chalk.green('‚úÖ Recording completed successfully!'));\n  console.log(chalk.gray(`Saved to: ${resolvedOutputPath}`));\n}\n\nconst program = new Command();\n\nprogram\n  .name('fspec-videos')\n  .description('Demo video recorder for fspec TUI using @microsoft/tui-test')\n  .version('0.1.0');\n\nprogram\n  .command('record')\n  .description('Record a demo video from a script')\n  .requiredOption('-s, --script <path>', 'Path to the demo script file')\n  .option('-o, --output <path>', 'Output video file path')\n  .option('-w, --width <number>', 'Terminal width in columns')\n  .option('-h, --height <number>', 'Terminal height in rows')\n  .option('--fps <number>', 'Frames per second')\n  .option('--no-headless', 'Run browser in non-headless mode (for debugging)')\n  .action(async options => {\n    try {\n      await recordAction(options);\n    } catch (error) {\n      console.error(chalk.red('‚ùå Recording failed:'), error);\n      process.exit(1);\n    }\n  });\n\nprogram\n  .command('list')\n  .description('List available demo scripts')\n  .action(() => {\n    try {\n      const demosDir = join(process.cwd(), 'src', 'demos');\n      const files = readdirSync(demosDir);\n\n      // Filter for TypeScript files and sort alphabetically\n      const demoScripts = files\n        .filter(file => file.endsWith('.ts'))\n        .sort();\n\n      console.log(chalk.blue('üìã Available demo scripts:'));\n      demoScripts.forEach(script => {\n        console.log(chalk.gray(`  - src/demos/${script}`));\n      });\n\n      console.log(\n        chalk.gray('\\nRun with: fspec-videos record -s src/demos/<script-name>.ts')\n      );\n    } catch (error) {\n      console.error(chalk.red('‚ùå Failed to list demo scripts:'), error);\n      process.exit(1);\n    }\n  });\n\n// Only parse if running as main module (not imported in tests)\nif (import.meta.url.startsWith('file:')) {\n  const modulePath = new URL(import.meta.url).pathname;\n  const scriptPath = process.argv[1];\n  if (modulePath === scriptPath || modulePath.replace(/\\.(js|ts)$/, '.js') === scriptPath) {\n    program.parse(process.argv);\n  }\n}\n"],"names":["Command","chalk","resolve","join","readdirSync","readFileSync","existsSync","startRecording","validateRecordingOptions","loadConfigFile","cwd","process","configPath","configContent","config","JSON","parse","error","SyntaxError","Error","recordAction","options","width","height","fps","outputPath","scriptPath","resolvedOutputPath","recordingOptions","console","log","blue","gray","script","parseInt","output","headless","green","program","name","description","version","command","requiredOption","option","action","red","exit","demosDir","files","demoScripts","filter","file","endsWith","sort","forEach","url","startsWith","modulePath","URL","pathname","argv","replace"],"mappings":"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","file":"index.js"}